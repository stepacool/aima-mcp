Okay this is a service that should generate MCP servers for user with a focus on actions. Paid tier does a VPS hosting and isn't really limited, free tier is all about attaching a generated starlette app with
  up to 3 endpoints/actions to the running main fastapi app. Just have to ensure this works.


WHAT WE NEED AND IS NOT THERE YET:
â¯ Implement the following plan:                                                                                                                                                                                      
                                                                                                                                                                                                                     
  # MCP Server Wizard Flow Alignment Plan                                                                                                                                                                            
                                                                                                                                                                                                                     
  ## Problem Summary                                                                                                                                                                                                 
  The wizard flow is fragmented with unclear state semantics:                                                                                                                                                        
  - Backend can't distinguish "generating tools" from "tools ready" (both use `wizard_step=describe`)                                                                                                                
  - No error state tracking when background tasks fail                                                                                                                                                               
  - State transitions scattered between service and route handlers                                                                                                                                                   
  - Frontend polls blindly without knowing if processing succeeded or failed                                                                                                                                         
                                                                                                                                                                                                                     
  ## Solution Overview                                                                                                                                                                                               
  Add a `processing_status` field to track async operations separately from `wizard_step`. Centralize all state transitions in the service layer. Add retry capability for failed operations.                        
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
                                                                                                                                                                                                                     
  ## Backend Changes                                                                                                                                                                                                 
                                                                                                                                                                                                                     
  ### 1. Add ProcessingStatus enum (`backend/src/infrastructure/models/mcp_server.py`)                                                                                                                               
                                                                                                                                                                                                                     
  ```python                                                                                                                                                                                                          
  class ProcessingStatus(str, Enum):                                                                                                                                                                                 
  """Status of background processing operations."""                                                                                                                                                                  
  IDLE = "idle"           # No background work in progress                                                                                                                                                           
  PROCESSING = "processing"  # Background task running                                                                                                                                                               
  FAILED = "failed"          # Background task failed                                                                                                                                                                
  ```                                                                                                                                                                                                                
                                                                                                                                                                                                                     
  Add properties to `MCPServer`:                                                                                                                                                                                     
  ```python                                                                                                                                                                                                          
  @property                                                                                                                                                                                                          
  def processing_status(self) -> str:                                                                                                                                                                                
  return self.meta.get("processing_status", ProcessingStatus.IDLE.value)                                                                                                                                             
                                                                                                                                                                                                                     
  @property                                                                                                                                                                                                          
  def processing_error(self) -> str | None:                                                                                                                                                                          
  return self.meta.get("processing_error")                                                                                                                                                                           
  ```                                                                                                                                                                                                                
                                                                                                                                                                                                                     
  ### 2. Add repository methods (`backend/src/infrastructure/repositories/mcp_server.py`)                                                                                                                            
                                                                                                                                                                                                                     
  - `update_processing_status(server_id, status, error=None)` - Update processing status in meta                                                                                                                     
  - `update_wizard_step_with_status(server_id, step, status)` - Update both atomically                                                                                                                               
                                                                                                                                                                                                                     
  ### 3. Update WizardService (`backend/src/core/services/wizard_service.py`)                                                                                                                                        
                                                                                                                                                                                                                     
  **`create_server_draft()`**: Set `processing_status=PROCESSING` in initial meta                                                                                                                                    
                                                                                                                                                                                                                     
  **`process_wizard_start()`**:                                                                                                                                                                                      
  - On success: `wizard_step=ACTIONS`, `processing_status=IDLE`                                                                                                                                                      
  - On failure: Keep `wizard_step=DESCRIBE`, set `processing_status=FAILED`, `processing_error=str(e)`                                                                                                               
                                                                                                                                                                                                                     
  **`confirm_actions()`**: Move AUTH transition from routes into this method                                                                                                                                         
                                                                                                                                                                                                                     
  **`configure_auth()`**: Move DEPLOY transition from routes into this method                                                                                                                                        
                                                                                                                                                                                                                     
  **Add `retry_tool_generation()`**: Reset to PROCESSING and allow re-running background task                                                                                                                        
                                                                                                                                                                                                                     
  **`get_server_state()`**: Include `processing_status` and `processing_error` in response                                                                                                                           
                                                                                                                                                                                                                     
  ### 4. Update routes (`backend/src/entrypoints/api/routes/wizard.py`)                                                                                                                                              
                                                                                                                                                                                                                     
  - Remove direct `update_wizard_step` calls from `select_tools` and `configure_auth` routes                                                                                                                         
  - Add `POST /wizard/{server_id}/retry` endpoint for retrying failed generation                                                                                                                                     
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
                                                                                                                                                                                                                     
  ## Frontend Changes                                                                                                                                                                                                
                                                                                                                                                                                                                     
  ### 1. Update schemas (`frontend/schemas/wizard-schemas.ts`)                                                                                                                                                       
                                                                                                                                                                                                                     
  Add ProcessingStatus:                                                                                                                                                                                              
  ```typescript                                                                                                                                                                                                      
  export const ProcessingStatus = {                                                                                                                                                                                  
  idle: "idle",                                                                                                                                                                                                      
  processing: "processing",                                                                                                                                                                                          
  failed: "failed",                                                                                                                                                                                                  
  } as const;                                                                                                                                                                                                        
  ```                                                                                                                                                                                                                
                                                                                                                                                                                                                     
  ### 2. Update API client (`frontend/lib/python-backend/wizard.ts`)                                                                                                                                                 
                                                                                                                                                                                                                     
  - Update `WizardState` interface to include `processing_status` and `processing_error`                                                                                                                             
  - Add `retryToolGeneration(serverId)` function                                                                                                                                                                     
                                                                                                                                                                                                                     
  ### 3. Update polling hook (`frontend/hooks/use-wizard-sessions.tsx`)                                                                                                                                              
                                                                                                                                                                                                                     
  Change `isProcessingStep()` to check `processing_status === "processing"` instead of `wizard_step === "describe"`                                                                                                  
                                                                                                                                                                                                                     
  Add callbacks:                                                                                                                                                                                                     
  - `onToolsReady` - when `wizard_step=actions` and `processing_status=idle`                                                                                                                                         
  - `onError` - when `processing_status=failed`                                                                                                                                                                      
                                                                                                                                                                                                                     
  Return additional fields: `hasFailed`, `processingError`                                                                                                                                                           
                                                                                                                                                                                                                     
  ### 4. Update main wizard component (`frontend/components/wizard/mcp-wizard-chat.tsx`)                                                                                                                             
                                                                                                                                                                                                                     
  - Handle error state with retry button                                                                                                                                                                             
  - Show appropriate UI based on `processing_status`:                                                                                                                                                                
  - `processing` -> spinner                                                                                                                                                                                          
  - `failed` -> error message with retry                                                                                                                                                                             
  - `idle` + `actions` -> tool selection UI                                                                                                                                                                          
                                                                                                                                                                                                                     
  ### 5. Update processing banner (`frontend/components/wizard/wizard-processing-banner.tsx`)                                                                                                                        
                                                                                                                                                                                                                     
  Add error state with retry button when `hasFailed=true`                                                                                                                                                            
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
                                                                                                                                                                                                                     
  ## State Transition Table                                                                                                                                                                                          
                                                                                                                                                                                                                     
  | Current Step | Processing Status | Trigger | Next Step | Next Processing |                                                                                                                                       
  |--------------|-------------------|---------|-----------|-----------------|                                                                                                                                       
  | - | - | POST /start | DESCRIBE | PROCESSING |                                                                                                                                                                    
  | DESCRIBE | PROCESSING | background success | ACTIONS | IDLE |                                                                                                                                                    
  | DESCRIBE | PROCESSING | background failure | DESCRIBE | FAILED |                                                                                                                                                 
  | DESCRIBE | FAILED | POST /retry | DESCRIBE | PROCESSING |                                                                                                                                                        
  | ACTIONS | IDLE | POST /tools/select | AUTH | IDLE |                                                                                                                                                              
  | AUTH | IDLE | POST /auth | DEPLOY | IDLE |                                                                                                                                                                       
  | DEPLOY | IDLE | POST /activate | COMPLETE | IDLE |                                                                                                                                                               
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
                                                                                                                                                                                                                     
  ## Files to Modify                                                                                                                                                                                                 
                                                                                                                                                                                                                     
  **Backend:**                                                                                                                                                                                                       
  1. `backend/src/infrastructure/models/mcp_server.py` - Add ProcessingStatus enum and properties                                                                                                                    
  2. `backend/src/infrastructure/repositories/mcp_server.py` - Add new repo methods                                                                                                                                  
  3. `backend/src/core/services/wizard_service.py` - Centralize transitions, add error handling                                                                                                                      
  4. `backend/src/entrypoints/api/routes/wizard.py` - Update routes, add retry endpoint                                                                                                                              
                                                                                                                                                                                                                     
  **Frontend:**                                                                                                                                                                                                      
  5. `frontend/schemas/wizard-schemas.ts` - Add ProcessingStatus type                                                                                                                                                
  6. `frontend/lib/python-backend/wizard.ts` - Update WizardState, add retry function                                                                                                                                
  7. `frontend/hooks/use-wizard-sessions.tsx` - Update polling logic                                                                                                                                                 
  8. `frontend/components/wizard/mcp-wizard-chat.tsx` - Handle error/retry states                                                                                                                                    
  9. `frontend/components/wizard/wizard-processing-banner.tsx` - Add error UI                                                                                                                                        
                                                                                                                                                                                                                     
  ---                                                                                                                                                                                                                
                                                                                                                                                                                                                     
  ## Verification                                                                                                                                                                                                    
                                                                                                                                                                                                                     
  1. **Happy path**: Start wizard -> poll shows processing -> tools appear -> select tools -> configure auth -> deploy                                                                                               
  2. **Error recovery**: Start wizard -> simulate LLM failure -> poll shows failed state -> click retry -> tools generate                                                                                            
  3. **Resume session**: Start wizard -> close tab -> reopen -> resume from current state                                                                                                                            
  4. **Run tests**: `cd backend && uv run pytest tests/test_wizard_steps.py -v`                                                                                                                                      
                                                                                                                                                                                                                     
                                                                                                                                                                                                                     
  If you need specific details from before exiting plan mode (like exact code snippets, error messages, or content you generated), read the full transcript at:                                                      
  /Users/stepanfilonov/.claude/projects/-Users-stepanfilonov-PycharmProjects-automcp/97d4cc9e-95c1-461d-98ef-e047b0585c25.jsonl                                                                                      
